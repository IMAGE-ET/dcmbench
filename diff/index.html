<!DOCTYPE html>
<html>

<head>
<title>DICOM Parser Diff</title>
<meta charset="UTF-8">
<link type="text/css" rel="stylesheet" href="../style.css" />

<!-- Third party -->
<script src="dcmjs/libs/jquery-1.11.0.min.js"></script>
<script src="diff/diff.js"></script>
<!-- local -->
<script src="dicomDiff.js"></script>

<!-- dcmjs -->
<script src="dcmjs/libs/dcmjs-nico.js"></script>
<script src="dcmjs/utils.js"></script>
<script type="text/javascript">
parse_0 = function (response) {
  // store lines
  var dumpLines = [];
  Module.print = function (s) {
    dumpLines += s + "\n";
  }
  // temp file name
  var fileName = 'temp';
  // write to FileSystem
  var content = new Int8Array(response);
  FS.writeFile(fileName, content, {encoding: "binary"});
  // run dcmtk command
  dcmjs.utils.execute('dcmdump', [fileName, "-Un"]);
  // return lines
  return dumpLines;
};
var function_0 = {
  "name": "dcmjs",
  "func": parse_0
};
</script>

<!-- dwv -->
<script src="dwv/dwv-0.10.1.min.js"></script>
<script type="text/javascript">
parse_2 = function (response) {
  // setup the dicom parser
  var dwvParser = new dwv.dicom.DicomParser();
  // parse the buffer
  dwvParser.parse(response);
  // return dump
  return dwvParser.getDicomElements().dump();
};
var function_2 = {
  "name": "dwv",
  "func": parse_2
};
</script>

<!-- real business -->
<script type="text/javascript">

// default test data
var defaultTestData = [ { "name": "osirix-toutatix-100",
    "url": "https://github.com/ivmartel/dcmbench/blob/master/data/osirix-toutatix-100.dcm?raw=true" },
    { "name": "osirix-goudurix",
    "url": "https://github.com/ivmartel/dcmbench/blob/master/data/osirix-goudurix.dcm?raw=true" },
    { "name": "dicompyler-ct.0",
    "url": "https://github.com/ivmartel/dcmbench/blob/master/data/dicompyler-ct.0.dcm?raw=true" },
    { "name": "gdcm-CR-MONO1-10-chest",
    "url": "https://github.com/ivmartel/dcmbench/blob/master/data/gdcm-CR-MONO1-10-chest.dcm?raw=true" },
    { "name": "gdcm-CT-MONO2-8-abdo",
    "url": "https://github.com/ivmartel/dcmbench/blob/master/data/gdcm-CT-MONO2-8-abdo.dcm?raw=true" },
    { "name": "gdcm-US-RGB-8-epicard",
    "url": "https://github.com/ivmartel/dcmbench/blob/master/data/gdcm-US-RGB-8-epicard.dcm?raw=true" },
    { "name": "gdcm-US-RGB-8-esopecho",
    "url": "https://github.com/ivmartel/dcmbench/blob/master/data/gdcm-US-RGB-8-esopecho.dcm?raw=true" }
  ];

// create DicomDump object
var dicomDiff = new DicomDiff( function_0, function_2, defaultTestData );

// handle dump launch
onDiffButton = function () {
  // run diff
  if ( dicomDiff.getStatus() === "ready" ||
    dicomDiff.getStatus() === "done" ||
    dicomDiff.getStatus() === "cancelled" ) {
    // run diff
    dicomDiff.run();
  }
  else if ( dicomDiff.getStatus() === "running" ) {
    // cancel diff
    dicomDiff.cancel();
  }
}

// last minute
$( document ).ready(function() {
  // output user agent
  var pAgent = document.createElement("p");
  pAgent.appendChild(document.createTextNode("User agent: " + navigator.userAgent))
  var resDiv = document.getElementById("browser");
  resDiv.appendChild(pAgent);
});
</script>
</head>

<body>

  <h1>DICOM Javascript parser dump diff</h1>

  <div id="browser"></div>

  <div id="diff-toolbar">
    <h2>Diff</h2>
    <button id="diff-button" onclick="onDiffButton()">Launch</button>
    <p id="diff-status">Ready</p>
  </div>
  <pre id="diff-results"></pre>

</body>

</html>
